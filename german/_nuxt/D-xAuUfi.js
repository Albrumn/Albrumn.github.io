import{ai as A,Y as p,x as s,L as d}from"./DoQLRuHK.js";import{u as M,a as k,s as f}from"./BVkePoiX.js";const C=A("requestStore",()=>{const{txt:o}=p(M()),{active_emp_id:_,isManager:S,profile:m}=p(k()),t=s(!1),u=s(!1),c=s([]),v=s(0),P=d(()=>[{id:1,name:o.value.pending},{id:2,name:o.value.approved},{id:3,name:o.value.denied}]),y=d(()=>t.value),i=s({isAsc:!0,orderBy:"created_at",page:1,perPage:10,search:""}),g=d(()=>(i.value.page-1)*i.value.perPage),w=d(()=>g.value+i.value.perPage-1),h=d(()=>{let e=new Date;e.setDate(e.getDate()+1),e.setHours(0,0,0,0);const a=new Date(e),n=new Date(e);return a.setHours(0,0,0,0),n.setHours(23,45,0,0),{id:0,created_by:m.value.account_id,created_at:new Date,modified_at:new Date,employee:{},location:{},status:1,start:a,end:n,note:""}});function I(){t.value=!1,c.value=[],v.value=0,i.value={isAsc:!0,orderBy:"created_at",page:1,perPage:10,search:""}}async function R(e){if(t.value)return"Error:  Please try again";t.value=!0;let a="";if(S.value){const{count:r}=await f.from("request").select(void 0,{count:"exact",head:!1}).eq("location_id",e).eq("employee_id",_.value).eq("status",1);r?u.value=r>0:u.value=!1}let n=f.from("request").select("id, created_by, created_at, modified_at, employee:employee_id(*), location:location_id(*), status, start, end, note",{count:"exact",head:!1}).eq("location_id",e);S.value||(n=n.eq("employee_id",_.value)),n=n.order("created_at",{ascending:!0}).range(g.value,w.value);const{data:l,count:b,error:D}=await n;return D?a=D.message:l&&(c.value=l.map(r=>({...r,start:new Date(r.start),end:new Date(r.end)})),v.value=b||0),t.value=!1,a}async function x(e,a,n){if(t.value||!m.value)return"Error:  Please try again";t.value=!0;let l="";const b=new Date(a),D=new Date(n),{data:r,count:B,error:E}=await f.from("request").select("id, created_by, created_at, modified_at, employee:employee_id(*), location:location_id(*), status, start, end, note",{count:"exact",head:!1}).eq("location_id",e).neq("status",3).lt("start",D.toISOString()).gt("end",b.toISOString()).order("employee(fname)",{ascending:!0}).order("start",{ascending:!0});return E?l=E.message:r&&(c.value=r.map(O=>({...O,start:new Date(O.start),end:new Date(O.end)})),v.value=B||0),t.value=!1,l}async function q(e){if(t.value)return"Error:  Please try again";t.value=!0;let a="",n=null;!e.id||e.id===0?n=f.from("request").insert([{created_by:m.value.account_id,created_at:new Date().toISOString(),employee_id:e.employee.id,location_id:e.location.id,start:new Date(e.start).toISOString(),end:new Date(e.end).toISOString(),note:e.note}]).select():n=f.from("request").update([{modified_at:new Date().toISOString(),employee_id:e.employee.id,location_id:e.location.id,status:e.status,start:new Date(e.start).toISOString(),end:new Date(e.end).toISOString(),note:e.note}]).eq("id",e.id).select();const{error:l}=await n;return l&&(a=l.message),t.value=!1,a}async function H(e,a){return t.value?"Error:  Please try again":(a=Math.floor(a),a<1||a>3?"Invalid status.":(e.status=a,await q(e)))}async function $(e){if(t.value)return"Error:  Please try again";t.value=!0;let a="";const{error:n}=await f.from("request").delete().eq("id",e);return n&&(a=n.message),t.value=!1,a}return{blankRequest:h,requests:c,requests_cnt:v,isPending:y,isReqPending:u,params:i,statuses:P,addUpdateRequest:q,deleteRequest:$,fetchRequests:R,fetchRequestsForSchedule:x,setStatus:H,$reset:I}}),N=A("pageStore",()=>{const{txt:o}=p(M()),_=k(),{currentLocationId:S,isManager:m,isMember:t,redeemedCodes:u}=p(_),c=C(),{isReqPending:v}=p(c),{fetchRequests:P}=c;P(S.value);const y=s(!1),i=s(!1),g=s(!1),w=s(!1),h=s(null),I=s(""),R=d(()=>[{title:o.value.account,id:1,icon:"mdi-account-circle-outline",to:"/account",isShow:!0},{title:o.value.schedules,id:2,icon:"mdi-calendar-blank-multiple",to:"/schedules",isShow:t.value&&u.value.length>0},{title:o.value.setup,id:3,icon:"mdi-card-account-details-outline",to:"/setup",isShow:m.value&&u.value.length>0},{title:v.value?`${o.value.requests} ❗`:o.value.requests,id:4,icon:"mdi-email-multiple-outline",to:"/request",isShow:t.value&&u.value.length>0},{title:o.value.support,id:5,icon:"mdi-frequently-asked-questions",to:"/support",isShow:t.value}]),x=d(()=>y.value);function q(){i.value=!1,g.value=!1,w.value=!1,h.value=null,y.value=!1}return{pages:R,changesExist:i,isForceNav:g,isWarningShown:w,tempNavTo:h,isPending:x,prevRoute:I,$reset:q}});export{N as u};
//# sourceMappingURL=D-xAuUfi.js.map
