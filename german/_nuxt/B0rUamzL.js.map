{"version":3,"file":"B0rUamzL.js","sources":["../../../../components/Login/UpdatePassword.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n    import {\r\n        useAppStore,\r\n        useAuthStore } from '#imports';\r\n    import { useFormRules } from '~/composables/useFormRules';\r\n\r\n    /* Store variables */\r\n    const { brandIcon, isMobile } = storeToRefs(useAppStore());\r\n    const authStore = useAuthStore();\r\n    const { isPending } = storeToRefs(authStore);\r\n    const { changePassword, getUser } = authStore;\r\n    const { required } = useFormRules();\r\n\r\n    /* Private variables */\r\n    const _email = ref<string>('');\r\n    const _errorMsg = ref<string>('');\r\n    const _password_confirm = ref<string>('');\r\n    const _password_new = ref<string>('');\r\n    const _serverFailureConfirmed = ref<boolean>(false);\r\n    const _successConfirmed = ref<boolean>(false);\r\n\r\n    /* UI references */\r\n    const form = ref<HTMLFormElement>();\r\n\r\n    /**\r\n     * Change the account's password based on the form data.\r\n     */\r\n    async function attemptChangePassword(): Promise<void> {\r\n        if (!form.value) return;\r\n        \r\n        const { valid } = await form.value.validate();\r\n        if (!valid) return;\r\n\r\n        if (_password_new.value !== _password_confirm.value) {\r\n            _errorMsg.value = 'New password and confirm password must match.';\r\n        }\r\n        else {\r\n            _errorMsg.value = await changePassword(_password_new.value);\r\n        }\r\n\r\n        _successConfirmed.value = _errorMsg.value === '';\r\n        _serverFailureConfirmed.value = !_successConfirmed.value;\r\n    }\r\n\r\n    /**\r\n     * Initialize or reset values.\r\n     */\r\n    async function init(): Promise<void> {\r\n        const user = await getUser();\r\n        _email.value = user.email;\r\n    }\r\n\r\n    await init();\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n        <div class=\"text-center my-6\">\r\n            <v-icon :icon=\"brandIcon\" size=\"64\" color=\"primary\" />\r\n        </div>\r\n        <v-card v-if=\"_email !== ''\"\r\n            title=\"Password Update\"\r\n            class=\"mx-auto\"\r\n            :class=\"isMobile ? 'rounded-0' : ''\"\r\n            width=\"400\"\r\n            :disabled=\"isPending\">\r\n            <v-card-text>\r\n                <v-expand-transition>\r\n                    <div v-show=\"!_successConfirmed\">\r\n                        <v-progress-linear indeterminate color=\"primary\" :style=\"isPending ? 'opacity: 1' : 'opacity: 0'\"/>\r\n                        <v-form ref=\"form\"\r\n                            validate-on=\"submit\">\r\n                            <v-text-field\r\n                                label=\"E-mail\"\r\n                                v-model=\"_email\"\r\n                                style=\"pointer-events: none;\"\r\n                                readonly />\r\n                            <v-text-field\r\n                                label=\"New Password\"\r\n                                v-model=\"_password_new\"\r\n                                type=\"password\"\r\n                                :rules=\"[required]\"\r\n                                @keydown.enter.exact.prevent=\"attemptChangePassword\" />\r\n                            <v-text-field\r\n                                label=\"Confirm Password\"\r\n                                v-model=\"_password_confirm\"\r\n                                type=\"password\"\r\n                                :rules=\"[required]\"\r\n                                @keydown.enter.exact.prevent=\"attemptChangePassword\" />\r\n                            <v-expand-transition>\r\n                                <div v-show=\"_serverFailureConfirmed\">\r\n                                    <p class=\"error-message\">\r\n                                        {{ _errorMsg.replace('Email', 'E-mail').replace('email', 'E-mail') }}\r\n                                    </p>\r\n                                </div>\r\n                            </v-expand-transition>\r\n                        </v-form>\r\n                    </div>\r\n                </v-expand-transition>\r\n                <v-expand-transition>\r\n                    <div v-show=\"_successConfirmed\">\r\n                        Your password has been updated.\r\n                    </div>\r\n                </v-expand-transition>\r\n            </v-card-text>\r\n            <v-card-actions class=\"px-3\">\r\n                <v-spacer />\r\n                <v-btn v-if=\"!_successConfirmed\"\r\n                    color=\"primary\"\r\n                    :disabled=\"!_password_new || _password_new.length === 0 || !_password_confirm || _password_confirm.length === 0\"\r\n                    :elevation=\"!_password_new || _password_new.length === 0 || !_password_confirm || _password_confirm.length === 0 ? 0 : 4\"\r\n                    @click.stop=\"attemptChangePassword\">\r\n                    Update\r\n                </v-btn>\r\n                <v-btn v-else\r\n                    color=\"primary\"\r\n                    elevation=\"4\"\r\n                    @click.stop=\"navigateTo('/login')\">\r\n                    Continue to Log In\r\n                </v-btn>\r\n                <v-spacer v-if=\"_successConfirmed\" />\r\n            </v-card-actions>\r\n        </v-card>\r\n        <v-card v-else-if=\"!_isPending\"\r\n            class=\"mx-auto\"\r\n            :class=\"$vuetify.display.mobile ? 'rounded-0' : ''\"\r\n            width=\"400\">\r\n            <v-toolbar \r\n                title=\"Account Receipt Error\"\r\n                color=\"error\"\r\n                density=\"compact\" />\r\n            <v-card-text>\r\n                No account data received.\r\n                <br>\r\n                Your password reset link may have expired.\r\n            </v-card-text>\r\n        </v-card>\r\n    </div>\r\n</template>"],"names":["brandIcon","isMobile","storeToRefs","useAppStore","authStore","useAuthStore","isPending","changePassword","getUser","required","useFormRules","_email","ref","_errorMsg","_password_confirm","_password_new","_serverFailureConfirmed","_successConfirmed","form","attemptChangePassword","valid","init","user","__temp","__restore","_withAsyncContext"],"mappings":"6iBAOI,KAAM,CAAE,UAAAA,EAAW,SAAAC,CAAa,EAAAC,EAAYC,IAAa,EACnDC,EAAYC,GAAa,EACzB,CAAE,UAAAC,CAAA,EAAcJ,EAAYE,CAAS,EACrC,CAAE,eAAAG,EAAgB,QAAAC,CAAA,EAAYJ,EAC9B,CAAE,SAAAK,CAAS,EAAIC,GAAa,EAG5BC,EAASC,EAAY,EAAE,EACvBC,EAAYD,EAAY,EAAE,EAC1BE,EAAoBF,EAAY,EAAE,EAClCG,EAAgBH,EAAY,EAAE,EAC9BI,EAA0BJ,EAAa,EAAK,EAC5CK,EAAoBL,EAAa,EAAK,EAGtCM,EAAON,EAAqB,EAKlC,eAAeO,GAAuC,CAC9C,GAAA,CAACD,EAAK,MAAO,OAEjB,KAAM,CAAE,MAAAE,CAAM,EAAI,MAAMF,EAAK,MAAM,SAAS,EACvCE,IAEDL,EAAc,QAAUD,EAAkB,MAC1CD,EAAU,MAAQ,gDAGlBA,EAAU,MAAQ,MAAMN,EAAeQ,EAAc,KAAK,EAG5CE,EAAA,MAAQJ,EAAU,QAAU,GACtBG,EAAA,MAAQ,CAACC,EAAkB,MAAA,CAMvD,eAAeI,GAAsB,CAC3B,MAAAC,EAAO,MAAMd,EAAQ,EAC3BG,EAAO,MAAQW,EAAK,KAAA,CAGxB,OAAAC,EAAAC,CAAA,EAAAC,EAAA,IAAMJ,GAAK"}